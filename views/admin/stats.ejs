<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<div class="container py-4">
  <div class="d-flex flex-column flex-md-row align-items-center justify-content-between mb-4">
    <h1 class="h3 fw-bold mb-3 mb-md-0"><i class="fas fa-eye text-primary me-2"></i>Statistiche Visite</h1>
    <span class="badge bg-primary bg-opacity-75 fs-6">
      Benvenuto,
      <% if (user) { %>
        <%= (user.first_name || user.last_name) ? ((user.first_name || '') + ' ' + (user.last_name || '')).trim() : (user.name || 'Admin') %>
      <% } else { %>
        Admin
      <% } %>
    </span>
  </div>
  <div class="row g-4">
    <div class="col-12 col-lg-4 mb-4 mb-lg-0">
      <div class="card border-0 shadow-sm h-100 text-center">
        <div class="card-body">
          <i class="fas fa-eye fa-3x text-primary mb-3"></i>
          <h5 class="card-title mb-2">Visite Totali</h5>
          <p class="display-4 fw-bold mb-0 text-primary"><%= views %></p>
          <span class="text-muted">Totale visite registrate su tutte le pagine</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-8">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-3"><i class="fas fa-chart-bar text-primary me-2"></i>Andamento visite ultimi 7 giorni</h5>
          <canvas id="visitsChart" height="120"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
const labels = <%- JSON.stringify(chartLabels) %>;
const data = {
  labels: labels,
  datasets: [{
    label: 'Visite',
  data: <%- JSON.stringify(chartData) %>,
    fill: true,
    backgroundColor: 'rgba(0, 31, 63, 0.15)',
    borderColor: '#001f3f',
    tension: 0.4,
    pointBackgroundColor: '#fff',
    pointBorderColor: '#001f3f',
    pointRadius: 6,
    pointHoverRadius: 8
  }]
};
const config = {
  type: 'line',
  data: data,
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      title: { display: false }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { color: '#001f3f', font: { weight: 'bold' } }
      },
      x: {
        ticks: { color: '#001f3f', font: { weight: 'bold' } }
      }
    }
  }
};
window.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('visitsChart').getContext('2d');
  new Chart(ctx, config);
});
</script>
